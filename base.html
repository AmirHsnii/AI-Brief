<!DOCTYPE html>
<!--
  AI Brief Manager â€” Sidebar UI (RTL)
  Purpose: Provide a right-to-left, Persian-first editor for creating and
  managing content briefs inside Google Sheets. The UI communicates with
  Apps Script functions exposed in main.gs via google.script.run, loads
  existing brief data, triggers AI generation for specific fields, and
  saves changes back to the BriefData sheet.

  Key parts:
  - Layout and styling (Bootstrap, Icons, Vazir font)
  - Toolbar (edit, save, AI actions)
  - Form fields for brief sections (title, SEO title, meta, outline, FAQ, etc.)
  - Client logic: toggle read-only/edit states, toast notifications,
    copy helpers, keyboard shortcuts, and calls to server functions:
      * getInitialData() â€” preload saved brief and model
      * saveData(...)    â€” persist current brief
      * generateContentFromServer(...) â€” AI generation per field
-->
<html lang="fa" dir="rtl">
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    @font-face {
      font-family: 'Vazir';
      src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font/dist/Vazir-Regular.woff2') format('woff2');
    }
    body {
      font-family: 'Vazir', sans-serif;
      direction: rtl;
      text-align: right;
      max-width: 100%;
      padding-right: 15px;
      padding-left: 15px;
    }
    input, textarea {
      transition: all 0.3s ease;
    }
    .readonly input:not(#topic), .readonly textarea {
      background-color: #f5f5f5 !important;
      pointer-events: none !important;
    }
    .form-label {
      font-weight: bold;
      margin-bottom: 0.25rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .form-icon {
      color: #00B894;
      font-size: 1.1rem;
      margin-left: 5px;
    }
    .btn-action {
      padding: 0.25rem 0.5rem;
      font-size: 0.8rem;
    }
    .section-header {
      color: #00B894;
      font-weight: bold;
      border-bottom: 2px solid #e0e0e0;
      margin: 1rem 0 0.5rem 0;
      padding-bottom: 0.25rem;
    }
    .loading {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid rgba(0, 184, 148, 0.3);
      border-radius: 50%;
      border-top-color: #00B894;
      animation: spin 1s ease-in-out infinite;
      margin-right: 0.5rem;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .toast-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 9999;
    }
    .copy-success {
      min-width: 200px;
      background-color: #d4edda;
      color: #155724;
      border-radius: 4px;
      padding: 0.75rem;
      margin-bottom: 0.5rem;
      display: none;
    }
    .toolbar {
      position: sticky;
      top: 0;
      background-color: #fff;
      padding: 10px 0;
      border-bottom: 1px solid #e0e0e0;
      margin-bottom: 10px;
      z-index: 100;
    }
    textarea.form-control {
      min-height: 70px;
    }
    /* Ù†Ù…Ø§ÛŒØ´ Ø§Ø³Ú©Ø±ÙˆÙ„â€ŒØ¨Ø§Ø± Ø²ÛŒØ¨Ø§ØªØ± */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }
    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² Ú©Ù„ÛŒÚ©â€ŒÙ¾Ø°ÛŒØ± Ø¨ÙˆØ¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
    .btn {
      position: relative;
      z-index: 10;
      cursor: pointer !important;
      pointer-events: auto !important;
    }
    .btn:hover {
      opacity: 0.9;
    }
    .ai-generate-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.25rem;
      padding: 0.2rem 0.5rem;
      font-size: 0.75rem;
      transition: transform 0.2s ease;
    }
    .ai-generate-btn i {
      font-size: 1rem;
    }
    .ai-generate-btn:disabled {
      opacity: 0.6;
      transform: none;
    }
    #aiLoadingOverlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }
    .ai-loading-content {
      background: rgba(10, 10, 10, 0.85);
      padding: 2rem;
      border-radius: 16px;
      text-align: center;
      color: #fff;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    .ai-orb {
      width: 70px;
      height: 70px;
      margin: 0 auto 1rem auto;
      border-radius: 50%;
      position: relative;
      background: radial-gradient(circle at 30% 30%, #74f7d3, #036bfc);
      animation: aiPulse 1.6s ease-in-out infinite;
      box-shadow: 0 0 20px rgba(116, 247, 211, 0.6);
    }
    .ai-orb::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 90px;
      height: 90px;
      border-radius: 50%;
      border: 2px dashed rgba(116, 247, 211, 0.4);
      animation: aiOrbit 2.4s linear infinite;
    }
    @keyframes aiPulse {
      0%, 100% {
        transform: scale(0.95);
        box-shadow: 0 0 12px rgba(116, 247, 211, 0.4);
      }
      50% {
        transform: scale(1.05);
        box-shadow: 0 0 24px rgba(3, 107, 252, 0.6);
      }
    }
    @keyframes aiOrbit {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="toast-container">
    <div id="copyToast" class="copy-success">
      <i class="bi bi-check-circle-fill me-1"></i> Ú©Ù¾ÛŒ Ø´Ø¯!
    </div>
  </div>
  
  <!-- ÙÛŒÙ„Ø¯ Ù…Ø®ÙÛŒ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ -->
  <input type="hidden" id="originalTitle">

  <div class="toolbar d-flex justify-content-between align-items-center">
    <h5 class="m-0" id="formTitle"></h5>
    <div class="btn-group btn-group-sm">
      <button class="btn btn-outline-secondary" id="editBtn" type="button" onclick="toggleEdit()">
        <i class="bi bi-pencil"></i> ÙˆÛŒØ±Ø§ÛŒØ´
      </button>
      <button class="btn btn-outline-primary" type="button" onclick="copyBrief()">
        <i class="bi bi-clipboard"></i> Ú©Ù¾ÛŒ
      </button>
      <button class="btn btn-outline-success" type="button" id="saveBtn" onclick="saveBrief()" disabled>
        <i class="bi bi-check-lg"></i> Ø°Ø®ÛŒØ±Ù‡
      </button>
    </div>
  </div>

  <div id="briefForm" class="readonly">
    <div class="mb-3">
      <label class="form-label" for="topic">
        <span><i class="bi bi-lightbulb form-icon"></i> Ù…ÙˆØ¶ÙˆØ¹</span>
      </label>
      <input type="text" class="form-control" id="topic" placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§ØµÙ„ÛŒ Ù…Ø­ØªÙˆØ§ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
    </div>

    <div class="mb-3">
      <label class="form-label" for="aiModel">
        <span><i class="bi bi-cpu form-icon"></i> Ù…Ø¯Ù„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</span>
      </label>
      <select class="form-select" id="aiModel">
        <option value="gpt-5-mini">GPT-5 Mini</option>
        <option value="google_gemini-google-gemini-2.5-flash">Google Gemini 2.5 Flash</option>
      </select>
    </div>
    
    <div class="mb-3">
      <label class="form-label" for="titleContent">
        <span><i class="bi bi-card-heading form-icon"></i> Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØªÙˆØ§</span>
      </label>
      <input type="text" class="form-control" id="titleContent" readonly>
    </div>
    
    <div class="mb-3">
      <label class="form-label" for="seoTitle">
        <span><i class="bi bi-tag form-icon"></i> Ø¹Ù†ÙˆØ§Ù† Ø³Ø¦Ùˆ</span>
        <button type="button" class="btn btn-outline-primary btn-sm ai-generate-btn" data-target="seoTitle" title="ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±" onclick="generateAiContent(event)" disabled>
          <i class="bi bi-sparkles"></i>
        </button>
      </label>
      <input type="text" class="form-control" id="seoTitle" readonly>
    </div>
    
    <div class="mb-3">
      <label class="form-label" for="metaDescription">
        <span><i class="bi bi-card-text form-icon"></i> Ù…ØªØ§ Ø¯ÛŒØ³Ú©Ø±ÛŒÙ¾Ø´Ù†</span>
        <button type="button" class="btn btn-outline-primary btn-sm ai-generate-btn" data-target="metaDescription" title="ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±" onclick="generateAiContent(event)" disabled>
          <i class="bi bi-sparkles"></i>
        </button>
      </label>
      <textarea class="form-control" id="metaDescription" rows="2" readonly></textarea>
    </div>
    
    <div class="mb-3">
      <label class="form-label" for="entities">
        <span><i class="bi bi-diagram-3 form-icon"></i> Ø§Ù†ØªÛŒØªÛŒ</span>
        <button type="button" class="btn btn-outline-primary btn-sm ai-generate-btn" data-target="entities" title="ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±" onclick="generateAiContent(event)" disabled>
          <i class="bi bi-sparkles"></i>
        </button>
      </label>
      <textarea class="form-control" id="entities" rows="2" readonly></textarea>
    </div>
    
    <div class="section-header">Ø³Ø§Ø®ØªØ§Ø± Ù…Ø­ØªÙˆØ§</div>
    
    <div class="mb-3">
      <label class="form-label" for="structure">
        <span><i class="bi bi-list-nested form-icon"></i> Ø³Ø§Ø®ØªØ§Ø± Ù…Ù‚Ø§Ù„Ù‡</span>
        <button type="button" class="btn btn-outline-primary btn-sm ai-generate-btn" data-target="structure" title="ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±" onclick="generateAiContent(event)" disabled>
          <i class="bi bi-sparkles"></i>
        </button>
      </label>
      <textarea class="form-control" id="structure" rows="5" readonly></textarea>
    </div>
    
    <div class="mb-3">
      <label class="form-label" for="faq">
        <span><i class="bi bi-question-circle form-icon"></i> Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„</span>
        <button type="button" class="btn btn-outline-primary btn-sm ai-generate-btn" data-target="faq" title="ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±" onclick="generateAiContent(event)" disabled>
          <i class="bi bi-sparkles"></i>
        </button>
      </label>
      <textarea class="form-control" id="faq" rows="2" readonly></textarea>
    </div>
    
    <div class="section-header">Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ Ùˆ SEO</div>
    
    <div class="mb-3">
      <label class="form-label" for="mainKeyword">
        <span><i class="bi bi-star-fill form-icon"></i> Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Ø§ØµÙ„ÛŒ</span>
      </label>
      <input type="text" class="form-control" id="mainKeyword" readonly>
    </div>
    
    <div class="mb-3">
      <label class="form-label" for="keywords">
        <span><i class="bi bi-hash form-icon"></i> Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ</span>
        <button type="button" class="btn btn-outline-primary btn-sm ai-generate-btn" data-target="keywords" title="ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø±" onclick="generateAiContent(event)" disabled>
          <i class="bi bi-sparkles"></i>
        </button>
      </label>
      <textarea class="form-control" id="keywords" rows="2" readonly></textarea>
    </div>
    
    <div class="section-header">Ù…ÙˆØ§Ø±Ø¯ ØªÚ©Ù…ÛŒÙ„ÛŒ</div>
    
    <div class="mb-3">
      <label class="form-label" for="richContent">
        <span><i class="bi bi-image form-icon"></i> Ù…Ø­ØªÙˆØ§ÛŒ ØºÙ†ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ</span>
      </label>
      <textarea class="form-control" id="richContent" rows="2" readonly></textarea>
    </div>
    
    <div class="mb-3">
      <label class="form-label" for="internalLinks">
        <span><i class="bi bi-link-45deg form-icon"></i> Ù„ÛŒÙ†Ú©Ø³Ø§Ø²ÛŒ Ø¯Ø§Ø®Ù„ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ</span>
      </label>
      <textarea class="form-control" id="internalLinks" rows="2" readonly></textarea>
    </div>
    
    <div class="mb-3">
      <label class="form-label" for="description">
        <span><i class="bi bi-info-circle form-icon"></i> ØªÙˆØ¶ÛŒØ­Ø§Øª</span>
      </label>
      <textarea class="form-control" id="description" rows="2" readonly></textarea>
    </div>
  </div>

  <div class="d-flex gap-2 mt-4 mb-4 justify-content-end">
    <button class="btn btn-secondary" type="button" onclick="google.script.host.close()">
      <i class="bi bi-x-lg"></i> Ø¨Ø³ØªÙ†
    </button>
  </div>

  <div id="aiLoadingOverlay">
    <div class="ai-loading-content">
      <div class="ai-orb"></div>
      <div class="fw-bold">AI Ø¯Ø± Ø­Ø§Ù„ ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§...</div>
    </div>
  </div>

  <script>
    // Ù…ØªØºÛŒØ± Ø¨Ø±Ø§ÛŒ Ú©Ù†ØªØ±Ù„ Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´
    let isEditMode = false;
    
    function showAiLoading() {
      document.getElementById('aiLoadingOverlay').style.display = 'flex';
    }

    function hideAiLoading() {
      document.getElementById('aiLoadingOverlay').style.display = 'none';
    }

    function generateAiContent(event) {
      event.preventDefault();
      const topic = document.getElementById('topic').value.trim();
      if (!topic) {
        alert('Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ Ù…ÙˆØ¶ÙˆØ¹ Ø±Ø§ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.');
        return;
      }

      const button = event.currentTarget;
      const targetId = button.getAttribute('data-target');
      if (!targetId) {
        alert('Ù‡Ø¯Ù ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§ Ù…Ø´Ø®Øµ Ù†ÛŒØ³Øª.');
        return;
      }

      const targetEl = document.getElementById(targetId);
      if (!targetEl) {
        alert('ÙÛŒÙ„Ø¯ Ù…ÙˆØ±Ø¯Ù†Ø¸Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯.');
        return;
      }

      const mainKeyword = document.getElementById('mainKeyword').value || '';
      const entities = document.getElementById('entities').value || '';
      const model = document.getElementById('aiModel').value || '';
      const context = {
        mainKeyword: mainKeyword,
        entities: entities,
        currentValue: targetEl.value || '',
        model: model
      };

      showAiLoading();
      button.disabled = true;

      google.script.run
        .withSuccessHandler(function(result) {
          targetEl.value = result || '';
          hideAiLoading();
          if (!isEditMode) {
            toggleEdit();
          }
          button.disabled = !isEditMode ? true : false;
        })
        .withFailureHandler(function(error) {
          hideAiLoading();
          button.disabled = !isEditMode ? true : false;
          alert('Ø®Ø·Ø§ Ø¯Ø± ØªÙˆÙ„ÛŒØ¯ Ù…Ø­ØªÙˆØ§: ' + (error && error.message ? error.message : 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ'));
        })
        .generateContentFromServer(targetId, topic, context);
    }

    // Ù†Ù…Ø§ÛŒØ´ Ø¹Ù†ÙˆØ§Ù† Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ÙØ±Ù…
    function updateFormTitle(title) {
      document.getElementById('formTitle').textContent = `Ø¨Ø±ÛŒÙ: ${title}`;
      document.title = `Ø¨Ø±ÛŒÙ: ${title}`;
    }
    
    // ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´/Ù…Ø´Ø§Ù‡Ø¯Ù‡
    function toggleEdit() {
      console.log("ØªØ§Ø¨Ø¹ toggleEdit ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´Ø¯");
      isEditMode = !isEditMode;
      
      const formEl = document.getElementById('briefForm');
      const editBtn = document.getElementById('editBtn');
      const saveBtn = document.getElementById('saveBtn');
      const aiButtons = document.querySelectorAll('.ai-generate-btn');
      
      if (isEditMode) {
        console.log("ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´");
        formEl.classList.remove('readonly');
        editBtn.innerHTML = '<i class="bi bi-eye"></i> Ù…Ø´Ø§Ù‡Ø¯Ù‡';
        editBtn.classList.replace('btn-outline-secondary', 'btn-outline-info');
        saveBtn.disabled = false;
        
        // ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù‚Ø§Ø¨Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒÙ… (Ø¨Ø§ Ø±ÙˆØ´ Ù…Ø³ØªÙ‚ÛŒÙ…â€ŒØªØ±)
        const inputs = document.querySelectorAll('#briefForm input');
        console.log("ØªØ¹Ø¯Ø§Ø¯ input Ù‡Ø§:", inputs.length);
        inputs.forEach(input => {
          if (input.id === 'topic') {
            input.readOnly = false;
            input.style.backgroundColor = '#ffffff';
            input.style.pointerEvents = 'auto';
            console.log("input ÙØ¹Ø§Ù„ Ø´Ø¯:", input.id);
            return;
          }
          input.readOnly = false;
          input.style.backgroundColor = '#ffffff';
          input.style.pointerEvents = 'auto';
          console.log("input ÙØ¹Ø§Ù„ Ø´Ø¯:", input.id);
        });
        
        const textareas = document.querySelectorAll('#briefForm textarea');
        console.log("ØªØ¹Ø¯Ø§Ø¯ textarea Ù‡Ø§:", textareas.length);
        textareas.forEach(textarea => {
          textarea.readOnly = false;
          textarea.style.backgroundColor = '#ffffff';
          textarea.style.pointerEvents = 'auto';
          console.log("textarea ÙØ¹Ø§Ù„ Ø´Ø¯:", textarea.id);
        });
        aiButtons.forEach(btn => {
          btn.disabled = false;
        });
        const modelSelect = document.getElementById('aiModel');
        modelSelect.disabled = false;
        modelSelect.style.backgroundColor = '#ffffff';
        modelSelect.style.pointerEvents = 'auto';
      } else {
        console.log("ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´");
        formEl.classList.add('readonly');
        editBtn.innerHTML = '<i class="bi bi-pencil"></i> ÙˆÛŒØ±Ø§ÛŒØ´';
        editBtn.classList.replace('btn-outline-info', 'btn-outline-secondary');
        saveBtn.disabled = true;
        
        // ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ ØºÛŒØ±Ù‚Ø§Ø¨Ù„ ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ù†ÛŒÙ…
        const inputs = document.querySelectorAll('#briefForm input');
        console.log("ØªØ¹Ø¯Ø§Ø¯ input Ù‡Ø§:", inputs.length);
        inputs.forEach(input => {
          if (input.id === 'topic') {
            input.readOnly = false;
            input.style.backgroundColor = '#ffffff';
            input.style.pointerEvents = 'auto';
            console.log("input ÙØ¹Ø§Ù„ Ø´Ø¯:", input.id);
            return;
          }
          input.readOnly = true;
          input.style.backgroundColor = '#f5f5f5';
          input.style.pointerEvents = 'none';
          console.log("input ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯:", input.id);
        });
        
        const textareas = document.querySelectorAll('#briefForm textarea');
        console.log("ØªØ¹Ø¯Ø§Ø¯ textarea Ù‡Ø§:", textareas.length);
        textareas.forEach(textarea => {
          textarea.readOnly = true;
          textarea.style.backgroundColor = '#f5f5f5';
          textarea.style.pointerEvents = 'none';
          console.log("textarea ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯:", textarea.id);
        });
        aiButtons.forEach(btn => {
          btn.disabled = true;
        });
        const modelSelect = document.getElementById('aiModel');
        modelSelect.disabled = true;
        modelSelect.style.backgroundColor = '#f5f5f5';
        modelSelect.style.pointerEvents = 'none';
        console.log("select ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯:", modelSelect.id);
      }
    }
    
    // Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±ÛŒÙ
    function saveBrief() {
      console.log("ØªØ§Ø¨Ø¹ saveBrief ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´Ø¯");
      const saveBtn = document.getElementById('saveBtn');
      const originalText = saveBtn.innerHTML;
      
      // Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØªÙˆØ§
      const titleContent = document.getElementById('titleContent').value.trim();
      if (!titleContent) {
        alert('Ù„Ø·ÙØ§ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØªÙˆØ§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
        return;
      }
      
      // Ù†Ù…Ø§ÛŒØ´ Ø­Ø§Ù„Øª Ø¯Ø± Ø­Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡
      saveBtn.innerHTML = '<span class="loading"></span> Ø°Ø®ÛŒØ±Ù‡...';
      saveBtn.disabled = true;
      
      // Ø¯Ø±ÛŒØ§ÙØª Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù† Ø±Ú©ÙˆØ±Ø¯ Ù‚Ø¨Ù„ÛŒ
      const originalTitle = document.getElementById('originalTitle').value;
      console.log("Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ:", originalTitle, "Ø¹Ù†ÙˆØ§Ù† Ø¬Ø¯ÛŒØ¯:", titleContent);
      
      // Ø³Ø§Ø®Øª Ø¢Ø¨Ø¬Ú©Øª Ø¯Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„
      const data = {
        originalTitle: originalTitle, // Ø¨Ø±Ø§ÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø±Ú©ÙˆØ±Ø¯ Ø§ØµÙ„ÛŒ
        titleContent: titleContent,
        seoTitle: document.getElementById('seoTitle').value,
        metaDescription: document.getElementById('metaDescription').value,
        structure: document.getElementById('structure').value,
        faq: document.getElementById('faq').value,
        mainKeyword: document.getElementById('mainKeyword').value,
        keywords: document.getElementById('keywords').value,
        entities: document.getElementById('entities').value,
        richContent: document.getElementById('richContent').value,
        internalLinks: document.getElementById('internalLinks').value,
        description: document.getElementById('description').value,
        aiModel: document.getElementById('aiModel').value
      };
      
      console.log("Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ±Ù… Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡:", data);
      
      google.script.run
        .withSuccessHandler((result) => {
          console.log("Ù†ØªÛŒØ¬Ù‡ Ø°Ø®ÛŒØ±Ù‡:", result);
          if (!result || !result.success) {
            alert('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ: ' + (result ? result.message : 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ'));
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
            return;
          }
          
          // Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø³Ù„ÙˆÙ„ ÙØ¹Ø§Ù„ (Ø§Ú¯Ø± Ø¨Ø±ÛŒÙ Ø¬Ø¯ÛŒØ¯ Ø§Ø³Øª)
          if (isNewBrief()) {
            google.script.run
              .withSuccessHandler((buttonResult) => {
                console.log("Ù†ØªÛŒØ¬Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡:", buttonResult);
                if (buttonResult) {
                  // Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ù…ÙˆÙÙ‚ÛŒØª
                  const toast = document.getElementById('copyToast');
                  toast.innerHTML = '<i class="bi bi-check-circle-fill me-1"></i> Ø¨Ø±ÛŒÙ Ø§ÛŒØ¬Ø§Ø¯ Ùˆ Ø¯Ú©Ù…Ù‡ Ù†Ù…Ø§ÛŒØ´ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯';
                  toast.style.display = 'block';
                  
                  setTimeout(() => {
                    toast.style.display = 'none';
                  }, 3000);
                } else {
                  alert('Ø¨Ø±ÛŒÙ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ Ø§Ù…Ø§ Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡ Ø¨Ù‡ ÙˆØ¬ÙˆØ¯ Ø¢Ù…Ø¯.');
                }
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¹Ù†ÙˆØ§Ù† ÙØ±Ù…
                updateFormTitle(titleContent);
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙÛŒÙ„Ø¯ Ù…Ø®ÙÛŒ Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ - Ø§ÛŒÙ† Ù…Ù‡Ù… Ø§Ø³Øª ØªØ§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø¹Ø¯ÛŒØŒ
                // Ø¹Ù†ÙˆØ§Ù† ÙØ¹Ù„ÛŒ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯
                document.getElementById('originalTitle').value = titleContent;
                
                // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
                toggleEdit();
              })
              .withFailureHandler((error) => {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡:", error);
                alert('Ø¨Ø±ÛŒÙ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯ Ø§Ù…Ø§ Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ú©Ù…Ù‡: ' + error.message);
                
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
              })
              .createButtonAfterSave(titleContent);
          } else {
            // Ù†Ù…Ø§ÛŒØ´ Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø±Ø§ÛŒ Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ
            const toast = document.getElementById('copyToast');
            toast.innerHTML = '<i class="bi bi-check-circle-fill me-1"></i> Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯';
            toast.style.display = 'block';
            
            setTimeout(() => {
              toast.style.display = 'none';
            }, 3000);
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¹Ù†ÙˆØ§Ù† ÙØ±Ù… (Ø¨Ø±Ø§ÛŒ Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ø¹Ù†ÙˆØ§Ù† ØªØºÛŒÛŒØ± Ú©Ø±Ø¯Ù‡ Ø¨Ø§Ø´Ø¯)
            updateFormTitle(titleContent);
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙÛŒÙ„Ø¯ Ù…Ø®ÙÛŒ Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ
            document.getElementById('originalTitle').value = titleContent;
            
            // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø­Ø§Ù„Øª Ø¹Ø§Ø¯ÛŒ
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
            toggleEdit();
          }
        })
        .withFailureHandler((error) => {
          console.error("Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ:", error);
          alert('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ: ' + (error.message || 'Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ'));
          saveBtn.innerHTML = originalText;
          saveBtn.disabled = false;
        })
        .saveData(data);
    }
    
    // Ú©Ù¾ÛŒ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±ÛŒÙ Ø¨Ù‡ Ú©Ù„ÛŒÙ¾Ø¨ÙˆØ±Ø¯
    function copyBrief() {
      console.log("ØªØ§Ø¨Ø¹ copyBrief ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø´Ø¯");
      // Ø³Ø§Ø®ØªÙ† Ù…ØªÙ† Ú©Ø§Ù…Ù„ Ø¨Ø±ÛŒÙ
      const titleContent = document.getElementById('titleContent').value;
      
      if (!titleContent) {
        alert('Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØªÙˆØ§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
        return;
      }
      
      // Ø³Ø§Ø®ØªÙ† Ù…ØªÙ† Ú©Ø§Ù…Ù„ Ø¨Ø±ÛŒÙ Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ø³Ø±ÙˆØ±
      let textOutput = `ğŸ“‹ Ø¨Ø±ÛŒÙ Ù…Ø­ØªÙˆØ§ÛŒÛŒ Ø¨Ø±Ø§ÛŒ Ø¢Ú©Ø§Ø¯Ù…ÛŒ Ø¨ÛŒØª Ù¾ÛŒÙ† ğŸ“‹\n\n`;
      
      textOutput += `ğŸ”¹ Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØªÙˆØ§:\n${titleContent || '-'}\n\n`;
      textOutput += `ğŸ”¹ Ø¹Ù†ÙˆØ§Ù† Ø³Ø¦Ùˆ:\n${document.getElementById('seoTitle').value || '-'}\n\n`;
      textOutput += `ğŸ”¹ Ù…ØªØ§ Ø¯ÛŒØ³Ú©Ø±ÛŒÙ¾Ø´Ù†:\n${document.getElementById('metaDescription').value || '-'}\n\n`;
      textOutput += `ğŸ”¹ Ø³Ø§Ø®ØªØ§Ø± Ù…Ù‚Ø§Ù„Ù‡:\n${document.getElementById('structure').value || '-'}\n\n`;
      textOutput += `ğŸ”¹ Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„:\n${document.getElementById('faq').value || '-'}\n\n`;
      textOutput += `ğŸ”¹ Ú©Ù„Ù…Ù‡ Ú©Ù„ÛŒØ¯ÛŒ Ø§ØµÙ„ÛŒ:\n${document.getElementById('mainKeyword').value || '-'}\n\n`;
      textOutput += `ğŸ”¹ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ:\n${document.getElementById('keywords').value || '-'}\n\n`;
      textOutput += `ğŸ”¹ Ø§Ù†ØªÛŒØªÛŒ:\n${document.getElementById('entities').value || '-'}\n\n`;
      textOutput += `ğŸ”¹ Ù…Ø­ØªÙˆØ§ÛŒ ØºÙ†ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:\n${document.getElementById('richContent').value || '-'}\n\n`;
      textOutput += `ğŸ”¹ Ù„ÛŒÙ†Ú©Ø³Ø§Ø²ÛŒ Ø¯Ø§Ø®Ù„ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:\n${document.getElementById('internalLinks').value || '-'}\n\n`;
      textOutput += `ğŸ”¹ ØªÙˆØ¶ÛŒØ­Ø§Øª:\n${document.getElementById('description').value || '-'}\n\n`;
      
      textOutput += `ğŸ”¸ ØªÙˆØ³Ø¹Ù‡ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· ØªÛŒÙ… Ø³Ø¦Ùˆ Ø¨ÛŒØª Ù¾ÛŒÙ† ğŸ”¸`;
      
      // Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ† Ø¯Ø± ÛŒÚ© textarea Ø¨Ø±Ø§ÛŒ Ú©Ù¾ÛŒ Ø¯Ø³ØªÛŒ
      const copyArea = document.createElement('div');
      copyArea.style.position = 'fixed';
      copyArea.style.top = '0';
      copyArea.style.left = '0';
      copyArea.style.width = '100%';
      copyArea.style.height = '100%';
      copyArea.style.backgroundColor = 'rgba(0,0,0,0.5)';
      copyArea.style.zIndex = '10000';
      copyArea.style.display = 'flex';
      copyArea.style.justifyContent = 'center';
      copyArea.style.alignItems = 'center';
      copyArea.style.padding = '20px';
      
      const copyBox = document.createElement('div');
      copyBox.style.backgroundColor = 'white';
      copyBox.style.padding = '20px';
      copyBox.style.borderRadius = '10px';
      copyBox.style.width = '90%';
      copyBox.style.maxWidth = '500px';
      copyBox.style.maxHeight = '80%';
      copyBox.style.overflowY = 'auto';
      copyBox.style.direction = 'rtl';
      
      const copyText = document.createElement('textarea');
      copyText.value = textOutput;
      copyText.style.width = '100%';
      copyText.style.height = '250px';
      copyText.style.padding = '10px';
      copyText.style.marginBottom = '15px';
      copyText.style.direction = 'rtl';
      copyText.style.fontFamily = 'Tahoma, Arial, sans-serif';
      copyText.onclick = function() {
        this.select();
      };
      
      const copyClose = document.createElement('button');
      copyClose.innerText = 'Ø¨Ø³ØªÙ†';
      copyClose.style.padding = '8px 15px';
      copyClose.style.backgroundColor = '#6c757d';
      copyClose.style.color = 'white';
      copyClose.style.border = 'none';
      copyClose.style.borderRadius = '5px';
      copyClose.style.cursor = 'pointer';
      copyClose.onclick = function() {
        document.body.removeChild(copyArea);
      };
      
      const copyInfo = document.createElement('p');
      copyInfo.innerText = 'Ù…ØªÙ† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±Ø¯Ù‡ Ùˆ Ø¨Ø§ Ctrl+C Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯';
      copyInfo.style.marginBottom = '15px';
      copyInfo.style.color = '#555';
      
      copyBox.appendChild(copyInfo);
      copyBox.appendChild(copyText);
      copyBox.appendChild(copyClose);
      copyArea.appendChild(copyBox);
      document.body.appendChild(copyArea);
      
      // Ø§Ù†ØªØ®Ø§Ø¨ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…ØªÙ†
      copyText.select();
      
      // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ù…ÙˆÙÙ‚ÛŒØª
      const toast = document.getElementById('copyToast');
      toast.innerHTML = '<i class="bi bi-info-circle-fill me-1"></i> Ù„Ø·ÙØ§Ù‹ Ù…ØªÙ† Ø±Ø§ Ø§Ø² Ú©Ø§Ø¯Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯';
      toast.style.display = 'block';
      
      setTimeout(() => {
        toast.style.display = 'none';
      }, 3000);
    }
    
    // Ø¨Ø±Ø±Ø³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ø¢ÛŒØ§ Ø§ÛŒÙ† ÛŒÚ© Ø¨Ø±ÛŒÙ Ø¬Ø¯ÛŒØ¯ Ø§Ø³Øª ÛŒØ§ Ø®ÛŒØ±
    function isNewBrief() {
      const originalTitle = document.getElementById('originalTitle').value;
      console.log("Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±ÛŒÙ Ø¬Ø¯ÛŒØ¯ØŒ Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ:", originalTitle);
      return originalTitle === '' || originalTitle === 'Ø¨Ø±ÛŒÙ Ø¬Ø¯ÛŒØ¯';
    }
    
    // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø§Ø² Ø³Ø±ÙˆØ±
    function initializeFields() {
      // Ø§Ø² Ø¯Ø§Ø®Ù„ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø³Ø±ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ØªØ§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ú¯ÛŒØ±ÛŒÙ…
      google.script.run
        .withSuccessHandler(function(data) {
          console.log("Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ Ø§Ø² Ø³Ø±ÙˆØ±:", data);
          
          // Ø§Ú¯Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­ Ø¢Ù…Ø¯Ù‡ Ø¨Ø§Ø´Ø¯
          if (data && data.isValid) {
            // ØªÙ†Ø¸ÛŒÙ… Ø¹Ù†ÙˆØ§Ù† Ø§ØµÙ„ÛŒ
            document.getElementById('originalTitle').value = data.isNewBrief ? 'Ø¨Ø±ÛŒÙ Ø¬Ø¯ÛŒØ¯' : data.title;
            
            // ØªÙ†Ø¸ÛŒÙ… Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØªÙˆØ§
            document.getElementById('titleContent').value = data.isNewBrief ? '' : data.title;
            
            // ØªÙ†Ø¸ÛŒÙ… Ø¹Ù†ÙˆØ§Ù† ÙØ±Ù…
            updateFormTitle(data.isNewBrief ? 'Ø§ÛŒØ¬Ø§Ø¯ Ø¨Ø±ÛŒÙ Ø¬Ø¯ÛŒØ¯' : data.title);
            
            // Ø§Ú¯Ø± Ø¨Ø±ÛŒÙ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³Øª Ùˆ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù† Ù‡Ù… ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯
            if (!data.isNewBrief && data.briefData) {
              document.getElementById('seoTitle').value = data.briefData.seoTitle || '';
              document.getElementById('metaDescription').value = data.briefData.metaDescription || '';
              document.getElementById('structure').value = data.briefData.structure || '';
              document.getElementById('faq').value = data.briefData.faq || '';
              document.getElementById('mainKeyword').value = data.briefData.mainKeyword || '';
              document.getElementById('keywords').value = data.briefData.keywords || '';
              document.getElementById('entities').value = data.briefData.entities || '';
              document.getElementById('richContent').value = data.briefData.richContent || '';
              document.getElementById('internalLinks').value = data.briefData.internalLinks || '';
              document.getElementById('description').value = data.briefData.description || '';
            }
            
            // Ø§Ú¯Ø± Ø¨Ø±ÛŒÙ Ø¬Ø¯ÛŒØ¯ Ø§Ø³ØªØŒ Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´ Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒÙ…
            if (data.isNewBrief) {
              setTimeout(toggleEdit, 100);
            } else {
              const savedModel = data.defaultModel || '';
              if (savedModel) {
                const modelSelect = document.getElementById('aiModel');
                const optionExists = Array.from(modelSelect.options).some(opt => opt.value === savedModel);
                if (optionExists) {
                  modelSelect.value = savedModel;
                } else {
                  modelSelect.insertAdjacentHTML('beforeend', `<option value="${savedModel}">${savedModel}</option>`);
                  modelSelect.value = savedModel;
                }
              }
              console.log("Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±ÛŒÙ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø¹Ù…Ø§Ù„ Ø´Ø¯");
            }
          } else {
            console.error("Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø² Ø³Ø±ÙˆØ±:", data);
          }
        })
        .withFailureHandler(function(error) {
          console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§:", error);
          alert("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª: " + (error.message || "Ø®Ø·Ø§ÛŒ Ù†Ø§Ù…Ø´Ø®Øµ"));
        })
        .getInitialData();
    }
    
    // Ø«Ø¨Øª Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª ØµØ±ÛŒØ­
    document.addEventListener('DOMContentLoaded', function() {
      console.log("ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯");
      
      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¬Ø¯Ø¯ Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ Ø¨Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¨ÛŒØ´ØªØ±
      document.getElementById('editBtn').onclick = toggleEdit;
      document.getElementById('saveBtn').onclick = saveBrief;
      
      // Ù„Ø§Ú¯ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
      const allButtons = document.querySelectorAll('button');
      console.log("ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§:", allButtons.length);
      allButtons.forEach((btn, index) => {
        console.log(`Ø¯Ú©Ù…Ù‡ ${index}:`, btn.innerText, "Ø¢ÛŒØ¯ÛŒ:", btn.id);
      });
      
      // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ÙÛŒÙ„Ø¯Ù‡Ø§
      initializeFields();
    });
    
    // Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ú©ÛŒØ¨ÙˆØ±Ø¯
    document.addEventListener('keydown', function(e) {
      // Ø°Ø®ÛŒØ±Ù‡ Ø¨Ø§ Ú©Ù„ÛŒØ¯ Ctrl+S
      if (e.ctrlKey && e.key === 's' && !document.getElementById('saveBtn').disabled) {
        e.preventDefault();
        saveBrief();
      }
      
      // ØªØºÛŒÛŒØ± Ø­Ø§Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´ Ø¨Ø§ Ú©Ù„ÛŒØ¯ Ctrl+E
      if (e.ctrlKey && e.key === 'e') {
        e.preventDefault();
        toggleEdit();
      }
    });

    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ù„Ú¯ÙˆÛŒ (polyfill) Ø¨Ø±Ø§ÛŒ Ù…ØªØ¯Ù‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ú©Ù‡ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¯Ø± Ø¨Ø±Ø®ÛŒ Ù…Ø­ÛŒØ·â€ŒÙ‡Ø§ÛŒ Ú¯ÙˆÚ¯Ù„ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù…ÙˆØ¬ÙˆØ¯ Ù†Ø¨Ø§Ø´Ù†Ø¯
    if (!Element.prototype.matches) {
      Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;
    }

    if (!Element.prototype.closest) {
      Element.prototype.closest = function(s) {
        var el = this;
        do {
          if (el.matches(s)) return el;
          el = el.parentElement || el.parentNode;
        } while (el !== null && el.nodeType === 1);
        return null;
      };
    }
  </script>
</body>
</html>
